<!DOCTYPE html>
<html lang="ko" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoMonitoring 제어판</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background-color: #f6f8fa; color: #24292f; }
        .card { background-color: #ffffff; border-color: #d0d7de; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card-header { background-color: #f6f8fa; border-bottom: 1px solid #d0d7de; font-weight: 500; }
        .form-control, .form-select { border-color: #d0d7de; }
        .btn-primary { --bs-btn-bg: #1f883d; --bs-btn-border-color: #1a7f37; --bs-btn-hover-bg: #1a7f37; --bs-btn-hover-border-color: #15732f; }
        .result-box { background-color: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; padding: 1rem; white-space: pre-wrap; word-break: break-all; font-family: "SFMono-Regular", Consolas, monospace; min-height: 100px; color: #24292f; }
        .sortable-header { cursor: pointer; user-select: none; }
        .sortable-header:hover { background-color: #f0f2f5; }
        .table-hover > tbody > tr:hover > * { background-color: #f0f2f5; }
        .input-group-text { background-color: #f6f8fa; }
    </style>
</head>
<body>
<div class="container py-5">
    <header class="pb-3 mb-4 border-bottom">
        <a href="/" class="d-flex align-items-center text-body text-decoration-none">
            <img src="/favicon.ico" class="me-2" style="width: 90px; height: 90px;" alt="icon">
            <span class="fs-4">AutoMonitoring 제어판</span>
            <img src="/favicon.ico" class="me-2" style="width: 90px; height: 90px;" alt="icon">
        </a>
    </header>

    <div class="row g-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header"><i class="bi bi-terminal me-2"></i>API Log</div>
                <div class="card-body">
                    <div id="api-log" class="result-box" style="max-height: 200px; overflow-y: auto;">콘솔 준비 완료.</div>
                </div>
            </div>
        </div>

        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-broadcast me-2"></i>실시간 모니터링 현황</span>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#search-collapse">
                            <i class="bi bi-search"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" id="btn-refresh-monitoring-list">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="collapse" id="search-collapse">
                    <div class="card-body bg-light">
                        <form id="search-form" class="row g-2 align-items-end">
                            <div class="col-md-3">
                                <label for="search-traceId" class="form-label form-label-sm">Trace ID</label>
                                <input type="text" class="form-control form-control-sm" id="search-traceId">
                            </div>
                            <div class="col-md-3">
                                <label for="search-channelId" class="form-label form-label-sm">Channel ID</label>
                                <input type="text" class="form-control form-control-sm" id="search-channelId">
                            </div>
                            <div class="col-md-3">
                                <label for="search-tp" class="form-label form-label-sm">TP</label>
                                <input type="text" class="form-control form-control-sm" id="search-tp">
                            </div>
                            <div class="col-md-3">
                                <label for="search-status" class="form-label form-label-sm">상태</label>
                                <select class="form-select form-select-sm" id="search-status">
                                    <option value="">전체</option>
                                    <option value="MONITORING">MONITORING</option>
                                    <option value="RETRYING">RETRYING</option>
                                    <option value="FAILED">FAILED</option>
                                    <option value="WRONG_URL">WRONG_URL</option>
                                    <option value="STOP">STOP</option>
                                </select>
                            </div>
                            <div class="col-12 d-grid">
                                <button type="submit" class="btn btn-sm btn-primary">검색</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                            <tr>
                                <th class="sortable-header p-3" data-sort="traceId">Trace ID <i class="bi bi-arrow-down-up small"></i></th>
                                <th class="sortable-header p-3" data-sort="channelName">Channel Name <i class="bi bi-arrow-down-up small"></i></th>
                                <th class="sortable-header p-3" data-sort="channelId">Channel ID <i class="bi bi-arrow-down-up small"></i></th>
                                <th class="sortable-header p-3" data-sort="tp">TP <i class="bi bi-arrow-down-up small"></i></th>
                                <th class="p-3"></th>
                            </tr>
                            </thead>
                            <tbody id="monitoring-list-body"></tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <label for="pageSizeInput" class="form-label me-2 mb-0 small">개수:</label>
                        <input type="number" class="form-control form-control-sm" id="pageSizeInput" value="20" style="width: 70px;">
                    </div>
                    <div id="monitoring-pagination" class="d-flex align-items-center"></div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header"><i class="bi bi-plus-circle me-2"></i>신규 모니터링 시작</div>
                <div class="card-body">
                    <form id="form-probe">
                        <div class="mb-3">
                            <label for="probe-url" class="form-label">Manifest URL</label>
                            <input type="text" class="form-control" id="probe-url" required>
                        </div>
                        <div class="mb-3">
                            <label for="probe-ua" class="form-label">User-Agent (선택 사항)</label>
                            <input type="text" class="form-control" id="probe-ua">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">요청</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header"><i class="bi bi-sliders me-2"></i>저장 옵션 설정</div>
                <div class="card-body">
                    <form id="form-set-options">
                        <div class="mb-3">
                            <label for="options-traceId" class="form-label">Trace ID</label>
                            <input type="text" class="form-control" id="options-traceId" required>
                        </div>
                        <div class="mb-3">
                            <label for="options-state" class="form-label">SaveM3u8State</label>
                            <select id="options-state" class="form-select">
                                <option>NONE</option>
                                <option>WITHOUT_ADSLATE</option>
                                <option>WITH_ADSLATE</option>
                                <option>ALWAYS</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">옵션 설정</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header"><i class="bi bi-lightning-charge me-2"></i>채널 및 시스템 작업</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="action-traceId" class="form-label">특정 채널 작업</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="action-traceId" required>
                            <button type="button" id="btn-refresh-channel-action" class="btn btn-outline-info"><i class="bi bi-arrow-clockwise"></i> 갱신</button>
                            <button type="button" id="btn-stop-channel-action" class="btn btn-outline-danger"><i class="bi bi-stop-circle"></i> 중지</button>
                        </div>
                    </div>
                    <hr>
                    <div>
                        <label class="form-label">전체 시스템 작업</label>
                        <button type="button" id="btn-refresh-all" class="btn btn-warning w-100"><i class="bi bi-exclamation-triangle"></i> 실패한 모든 모니터링 갱신</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header"><i class="bi bi-gear-fill me-2"></i>전체 시스템 설정</div>
                <div class="card-body">
                    <form id="form-config">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label small">Threshold</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="config-threshold" class="form-control">
                                    <span class="input-group-text" id="current-config-threshold"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">Alarm Cooldown (s)</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="config-alarmCooldownSeconds" class="form-control">
                                    <span class="input-group-text" id="current-config-alarmCooldownSeconds"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">Reconnect Threshold</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="config-reconnectThreshold" class="form-control">
                                    <span class="input-group-text" id="current-config-reconnectThreshold"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">Reconnect Timeout (ms)</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="config-reconnectTimeoutMillis" class="form-control">
                                    <span class="input-group-text" id="current-config-reconnectTimeoutMillis"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">Reconnect Retry (ms)</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="config-reconnectRetryDelayMillis" class="form-control">
                                    <span class="input-group-text" id="current-config-reconnectRetryDelayMillis"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">HTTP Timeout (ms)</label>
                                <div class="input-group input-group-sm">
                                    <input type="number" id="config-httpRequestTimeoutMillis" class="form-control">
                                    <span class="input-group-text" id="current-config-httpRequestTimeoutMillis"></span>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row pt-2">
                                    <div class="col-auto">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="config-alarmEnabled">
                                            <label class="form-check-label small" for="config-alarmEnabled">Alarm</label>
                                            <span class="badge ms-1" id="current-config-alarmEnabled"></span>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="config-autoRefresh">
                                            <label class="form-check-label small" for="config-autoRefresh">Auto Refresh</label>
                                            <span class="badge ms-1" id="current-config-autoRefresh"></span>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="config-monitoringEnabled">
                                            <label class="form-check-label small" for="config-monitoringEnabled">Monitoring</label>
                                            <span class="badge ms-1" id="current-config-monitoringEnabled"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary w-100 mt-3">전체 설정 업데이트</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="statusModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statusModalLabel">상세 정보</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="statusModalBody"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const log = (message, data) => {
        const logBox = document.getElementById('api-log');
        const timestamp = new Date().toLocaleTimeString();
        let content = `<div><span class="text-muted">[${timestamp}]</span> ${message}</div>`;
        if (data) {
            const pre = document.createElement('pre');
            pre.className = 'bg-white p-2 rounded small';
            pre.textContent = JSON.stringify(data, null, 2);
            content += pre.outerHTML;
        }
        logBox.innerHTML += content;
        logBox.scrollTop = logBox.scrollHeight;
    };

    async function apiFetch(url, options) {
        log(`요청: ${options.method || 'GET'} ${url}`, options.body ? JSON.parse(options.body) : undefined);
        try {
            const response = await fetch(url, options);
            const isJson = response.headers.get('content-type')?.includes('application/json');
            const data = isJson ? await response.json() : await response.text();
            if (!response.ok) throw new Error(data.message || (typeof data === 'string' ? data : '오류가 발생했습니다.'));
            log(`응답 성공: ${response.status}`, data);
            return data;
        } catch (error) {
            log(`응답 실패: ${error.message}`);
            throw error;
        }
    }

    const monitoringState = { page: 0, size: 20, sort: 'id', direction: 'DESC', traceId: '', channelId: '', tp: '', resolutionStatus: '' };
    const monitoringListBody = document.getElementById('monitoring-list-body');
    const paginationContainer = document.getElementById('monitoring-pagination');
    const statusModal = new bootstrap.Modal(document.getElementById('statusModal'));
    const statusModalBody = document.getElementById('statusModalBody');
    const statusModalLabel = document.getElementById('statusModalLabel');

    async function fetchMonitoringPrograms() {
        const { page, size, sort, direction, traceId, channelId, tp, resolutionStatus } = monitoringState;
        const params = new URLSearchParams({ page, size, sort, direction });
        if (traceId) params.append('traceId', traceId);
        if (channelId) params.append('channelId', channelId);
        if (tp) params.append('tp', tp);
        if (resolutionStatus) params.append('resolutionStatus', resolutionStatus);

        try {
            const data = await apiFetch(`/api/dashboard/monitoring?${params}`, { method: 'GET' });
            renderMonitoringList(data);
            renderPagination(data);
            updateSortIcons();
        } catch (error) {
            monitoringListBody.innerHTML = `<tr><td colspan="5" class="text-center text-danger">모니터링 목록을 불러오는데 실패했습니다.</td></tr>`;
        }
    }

    function renderMonitoringList(data) {
        monitoringListBody.innerHTML = '';
        if (!data || data.content.length === 0) {
            monitoringListBody.innerHTML = `<tr><td colspan="5" class="text-center text-muted p-4">표시할 항목이 없습니다.</td></tr>`;
            return;
        }
        data.content.forEach(item => {
            const tr = document.createElement('tr');
            tr.style.cursor = 'pointer';
            tr.innerHTML = `
                <td class="p-3 align-middle">${item.traceId || '-'}</td>
                <td class="p-3 align-middle">${item.channelName || '-'}</td>
                <td class="p-3 align-middle">${item.channelId || '-'}</td>
                <td class="p-3 align-middle">${item.tp || '-'}</td>
                <td class="p-3 align-middle text-end"><i class="bi bi-chevron-right"></i></td>
            `;
            tr.addEventListener('click', async () => {
                statusModalLabel.textContent = `상세 정보: ${item.traceId}`;
                statusModalBody.innerHTML = '<div class="d-flex justify-content-center p-5"><div class="spinner-border"></div></div>';
                statusModal.show();
                try {
                    const statusData = await apiFetch(`/api/status/${item.traceId}`, { method: 'GET' });
                    statusModalBody.innerHTML = `
                        <dl class="row mb-0">
                            <dt class="col-sm-3">Master URL</dt><dd class="col-sm-9"><small class="text-break">${item.masterManifestUrl || '-'}</small></dd>
                        </dl>
                        <hr class="my-3">
                        <h6><i class="bi bi-hdd-stack"></i> 해상도별 상태</h6>
                        <table class="table table-sm table-bordered">
                            <thead class="table-light"><tr><th>Resolution</th><th>Status</th></tr></thead>
                            <tbody>${Object.entries(statusData).map(([res, status]) => `<tr><td>${res}</td><td>${status}</td></tr>`).join('')}</tbody>
                        </table>`;
                } catch (e) {
                    statusModalBody.innerHTML = `<div class="alert alert-danger">상태 정보를 불러오는데 실패했습니다: ${e.message}</div>`;
                }
            });
            monitoringListBody.appendChild(tr);
        });
    }

    function renderPagination(data) {
        paginationContainer.innerHTML = '';
        if (!data || data.totalPages <= 0) return;

        const { number, totalPages, first, last } = data;
        const currentPage = number + 1;

        // Previous button
        paginationContainer.innerHTML += `<button class="btn btn-sm btn-outline-secondary me-1" data-page="${number - 1}" ${first ? 'disabled' : ''}>이전</button>`;

        // Page input form
        paginationContainer.innerHTML += `
            <form id="page-jump-form" class="d-flex align-items-center me-1">
                <input type="number" class="form-control form-control-sm" value="${currentPage}" min="1" max="${totalPages}" style="width: 80px;">
                <span class="mx-2 text-muted small">/ ${totalPages}</span>
                <button type="submit" class="btn btn-sm btn-secondary">이동</button>
            </form>
        `;

        // Next button
        paginationContainer.innerHTML += `<button class="btn btn-sm btn-outline-secondary" data-page="${number + 1}" ${last ? 'disabled' : ''}>다음</button>`;
    }


    function updateSortIcons() {
        document.querySelectorAll('.sortable-header').forEach(header => {
            const key = header.dataset.sort;
            const icon = header.querySelector('i');
            if (key === monitoringState.sort) {
                icon.className = monitoringState.direction === 'ASC' ? 'bi bi-arrow-up small' : 'bi bi-arrow-down small';
            } else {
                icon.className = 'bi bi-arrow-down-up small';
            }
        });
    }

    paginationContainer.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON' && e.target.hasAttribute('data-page')) {
            e.preventDefault();
            monitoringState.page = parseInt(e.target.getAttribute('data-page'));
            fetchMonitoringPrograms();
        }
    });

    paginationContainer.addEventListener('submit', (e) => {
        if (e.target.id === 'page-jump-form') {
            e.preventDefault();
            const input = e.target.querySelector('input');
            let targetPage = parseInt(input.value) - 1;
            if (isNaN(targetPage)) targetPage = 0;

            const totalPages = parseInt(input.max);
            if (targetPage < 0) targetPage = 0;
            if (targetPage >= totalPages) targetPage = totalPages - 1;

            monitoringState.page = targetPage;
            fetchMonitoringPrograms();
        }
    });

    document.getElementById('btn-refresh-monitoring-list').addEventListener('click', fetchMonitoringPrograms);

    document.getElementById('pageSizeInput').addEventListener('change', () => {
        monitoringState.size = parseInt(document.getElementById('pageSizeInput').value);
        monitoringState.page = 0;
        fetchMonitoringPrograms();
    });

    document.getElementById('search-form').addEventListener('submit', e => {
        e.preventDefault();
        monitoringState.traceId = document.getElementById('search-traceId').value;
        monitoringState.channelId = document.getElementById('search-channelId').value;
        monitoringState.tp = document.getElementById('search-tp').value;
        monitoringState.resolutionStatus = document.getElementById('search-status').value;
        monitoringState.page = 0;
        fetchMonitoringPrograms();
    });

    document.getElementById('search-status').addEventListener('change', () => {
        monitoringState.resolutionStatus = document.getElementById('search-status').value;
        monitoringState.page = 0;
        fetchMonitoringPrograms();
    });

    document.querySelectorAll('.sortable-header').forEach(header => {
        header.addEventListener('click', () => {
            const sortKey = header.dataset.sort;
            if (monitoringState.sort === sortKey) {
                monitoringState.direction = monitoringState.direction === 'ASC' ? 'DESC' : 'ASC';
            } else {
                monitoringState.sort = sortKey;
                monitoringState.direction = 'DESC';
            }
            monitoringState.page = 0;
            fetchMonitoringPrograms();
        });
    });

    document.getElementById('form-probe').addEventListener('submit', async (e) => {
        e.preventDefault();
        await apiFetch('/probe', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url: document.getElementById('probe-url').value, userAgent: document.getElementById('probe-ua').value || undefined }),
        });
        fetchMonitoringPrograms();
    });

    document.getElementById('btn-stop-channel-action').addEventListener('click', async () => {
        const traceId = document.getElementById('action-traceId').value;
        if (!traceId) { log('Trace ID를 입력하세요.'); return; }
        await apiFetch(`/probe/${traceId}/stop`, { method: 'POST' });
        fetchMonitoringPrograms();
    });

    document.getElementById('btn-refresh-channel-action').addEventListener('click', async () => {
        const traceId = document.getElementById('action-traceId').value;
        if (!traceId) { log('Trace ID를 입력하세요.'); return; }
        await apiFetch(`/probe/${traceId}/refresh`, { method: 'POST' });
        fetchMonitoringPrograms();
    });

    document.getElementById('btn-refresh-all').addEventListener('click', async () => {
        await apiFetch('/probe/refreshAll', { method: 'POST' });
        fetchMonitoringPrograms();
    });

    document.getElementById('form-set-options').addEventListener('submit', async (e) => {
        e.preventDefault();
        const traceId = document.getElementById('options-traceId').value;
        const saveM3u8State = document.getElementById('options-state').value;
        await apiFetch('/arguments/setOptions', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ traceId, saveM3u8State }),
        });
    });

    document.getElementById('form-config').addEventListener('submit', async (e) => {
        e.preventDefault();
        const config = {
            alarmEnabled: document.getElementById('config-alarmEnabled').checked,
            autoRefresh: document.getElementById('config-autoRefresh').checked,
            monitoringEnabled: document.getElementById('config-monitoringEnabled').checked,
            threshold: parseInt(document.getElementById('config-threshold').value) || 0,
            alarmCooldownSeconds: parseInt(document.getElementById('config-alarmCooldownSeconds').value) || 0,
            reconnectThreshold: parseInt(document.getElementById('config-reconnectThreshold').value) || 0,
            reconnectTimeoutMillis: parseInt(document.getElementById('config-reconnectTimeoutMillis').value) || 0,
            reconnectRetryDelayMillis: parseInt(document.getElementById('config-reconnectRetryDelayMillis').value) || 0,
            httpRequestTimeoutMillis: parseInt(document.getElementById('config-httpRequestTimeoutMillis').value) || 0,
        };
        await apiFetch('/api/config/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(config),
        });
        loadCurrentConfig(); // 업데이트 후 최신 설정 다시 로드
    });
    
    let defaultConfigStore = {};
    const configInputIds = [
        'threshold', 'alarmCooldownSeconds', 'reconnectThreshold',
        'reconnectTimeoutMillis', 'reconnectRetryDelayMillis', 'httpRequestTimeoutMillis'
    ];

    function updateCurrentConfigValue(id, value, isSwitch = false) {
        const currentEl = document.getElementById(`current-config-${id}`);
        if (!currentEl) return;
        
        if (isSwitch) {
            currentEl.textContent = value ? 'ON' : 'OFF';
            currentEl.className = value ? 'badge bg-success ms-1' : 'badge bg-secondary ms-1';
        } else {
            currentEl.textContent = value;
        }
    }

    async function loadCurrentConfig() {
        try {
            const current = await apiFetch('/api/config/current', { method: 'GET' });
            if (!current) return;
            
            updateCurrentConfigValue('alarmEnabled', current.alarmEnabled, true);
            updateCurrentConfigValue('autoRefresh', current.autoRefresh, true);
            updateCurrentConfigValue('monitoringEnabled', current.monitoringEnabled, true);
            configInputIds.forEach(id => updateCurrentConfigValue(id, current[id]));
            
            log('현재 적용된 설정 값을 화면에 표시했습니다.');
        } catch (error) {
            log('현재 적용된 설정 값을 불러오는데 실패했습니다.');
        }
    }

    async function loadDefaults() {
        try {
            const defaults = await apiFetch('/api/config/defaults', { method: 'GET' });
            if (!defaults) return;
            defaultConfigStore = defaults; // 기본값 저장
            
            // Input 필드에 기본값 설정
            document.getElementById('config-alarmEnabled').checked = defaults.alarmEnabled;
            document.getElementById('config-autoRefresh').checked = defaults.autoRefresh;
            document.getElementById('config-monitoringEnabled').checked = defaults.monitoringEnabled;
            
            configInputIds.forEach(id => {
                const inputEl = document.getElementById(`config-${id}`);
                if(inputEl) {
                    inputEl.value = defaults[id];
                    // 입력값이 비워지면 기본값으로 복원하는 이벤트 리스너
                    inputEl.addEventListener('blur', (e) => {
                        if (e.target.value === '') {
                            e.target.value = defaultConfigStore[id];
                        }
                    });
                }
            });
            log('기본 설정 값을 폼에 적용했습니다.');
        } catch (error) {
            log('기본 설정 값을 불러오는데 실패했습니다.');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadDefaults();
        loadCurrentConfig();
        fetchMonitoringPrograms();
    });
</script>
</body>
</html>
</body>
</html>