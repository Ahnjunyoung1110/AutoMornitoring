<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AutoMonitoring Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-50">
<div class="min-h-screen flex">

    <!-- Sidebar -->
    <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col">
        <div class="px-6 py-4 border-b border-slate-800 flex items-center gap-2">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-xl bg-emerald-500/10 text-emerald-400">
                AM
            </span>
            <div>
                <div class="font-semibold text-slate-100">AutoMonitoring</div>
                <div class="text-xs text-slate-400">HLS Validation Console</div>
            </div>
        </div>

        <nav class="flex-1 px-3 py-4 space-y-2 text-sm">
            <div class="text-xs font-semibold text-slate-500 uppercase px-2 mb-2">
                Monitor
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ ë²„íŠ¼ -->
            <button id="nav-dashboard"
                    class="w-full flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-800 text-slate-100">
                <span class="w-1 h-4 rounded bg-emerald-500"></span>
                ëŒ€ì‹œë³´ë“œ
            </button>

            <!-- ì±„ë„ ë²„íŠ¼ -->
            <button id="nav-channels"
                    class="w-full flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-800 text-slate-300">
                <span class="w-1 h-4 rounded bg-slate-600"></span>
                ì±„ë„
            </button>
        </nav>

        <div class="px-4 py-3 border-t border-slate-800 text-xs text-slate-500">
            <div>Last refresh: <span id="last-refresh" class="text-slate-300">â€“</span></div>
        </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 flex flex-col">
        <!-- Top bar -->
        <header class="h-14 border-b border-slate-800 flex items-center justify-between px-6">
            <div>
                <div id="header-title" class="text-sm font-semibold text-slate-100">
                    Validation Dashboard
                </div>
                <div id="header-subtitle" class="text-xs text-slate-400">
                    ì‹¤ì‹œê°„ HLS manifest ìœ íš¨ì„± ìƒíƒœ
                </div>
            </div>
            <button id="refresh-btn"
                    class="px-3 py-1.5 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-slate-200 border border-slate-700">
                ìƒˆë¡œê³ ì¹¨
            </button>
        </header>

        <!-- Views -->
        <section class="flex-1 p-6">

            <!-- ëŒ€ì‹œë³´ë“œ í™”ë©´ -->
            <div id="view-dashboard" class="space-y-4">
                <!-- ìš”ì•½ ì¹´ë“œ 3ê°œ -->
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-slate-900/80 border border-slate-800 rounded-2xl p-4">
                        <div class="text-xs text-slate-400 mb-1">ì „ì²´ ì±„ë„</div>
                        <div id="summary-total" class="text-2xl font-semibold text-slate-100">â€“</div>
                    </div>
                    <div class="bg-slate-900/80 border border-slate-800 rounded-2xl p-4">
                        <div class="text-xs text-slate-400 mb-1">MONITORING ì±„ë„</div>
                        <div id="summary-monitoring" class="text-2xl font-semibold text-emerald-300">â€“</div>
                    </div>
                    <div class="bg-slate-900/80 border border-slate-800 rounded-2xl p-4">
                        <div class="text-xs text-slate-400 mb-1">ìµœê·¼ 24ì‹œê°„ ì˜¤ë¥˜</div>
                        <div id="summary-errors" class="text-2xl font-semibold text-red-300">â€“</div>
                    </div>
                </div>

                <!-- ìµœê·¼ ì•ŒëŒ + íˆìŠ¤í† ë¦¬ -->
                <div class="grid grid-cols-5 gap-4">
                    <!-- ìµœê·¼ ì•ŒëŒ -->
                    <div class="col-span-2 bg-slate-900/80 border border-slate-800 rounded-2xl p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">ğŸš¨</span>
                                <div class="text-sm font-semibold text-slate-100">ìµœê·¼ ì•ŒëŒ</div>
                            </div>
                        </div>
                        <div id="alarm-list" class="space-y-2 text-xs max-h-80 overflow-y-auto">
                            <div class="text-slate-500 text-center py-6 text-xs">
                                ì•ŒëŒ ë°ì´í„° ë¡œë”© ì¤‘...
                            </div>
                        </div>
                    </div>

                    <!-- ìµœê·¼ ê²€ì¦ íˆìŠ¤í† ë¦¬ -->
                    <div class="col-span-3 bg-slate-900/80 border border-slate-800 rounded-2xl p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-sm font-semibold text-slate-100">ìµœê·¼ ê²€ì¦ íˆìŠ¤í† ë¦¬</div>
                            <div class="text-xs text-slate-500">ìµœê·¼ 20ê±´</div>
                        </div>
                        <div class="overflow-x-auto text-xs">
                            <table class="min-w-full border-separate border-spacing-y-1">
                                <thead class="text-[11px] uppercase text-slate-500">
                                <tr>
                                    <th class="text-left px-2 py-1">TraceId</th>
                                    <th class="text-left px-2 py-1">Resolution</th>
                                    <th class="text-left px-2 py-1">Status</th>
                                    <th class="text-left px-2 py-1">Rule</th>
                                    <th class="text-left px-2 py-1">Time</th>
                                </tr>
                                </thead>
                                <tbody id="history-body" class="align-top">
                                <tr>
                                    <td colspan="5" class="px-2 py-4 text-center text-slate-500">
                                        ë°ì´í„° ë¡œë”© ì¤‘...
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì±„ë„ í™”ë©´ -->
            <div id="view-channels" class="hidden h-full">
                <div class="grid grid-cols-5 gap-4 h-full">
                    <!-- ì±„ë„ ë¦¬ìŠ¤íŠ¸ -->
                    <div class="col-span-2 bg-slate-900/80 border border-slate-800 rounded-2xl p-4 flex flex-col">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-sm font-semibold text-slate-100">ëª¨ë‹ˆí„°ë§ ì±„ë„</div>
                            <button id="btn-open-new-channel"
                                    class="px-2.5 py-1 rounded-lg bg-emerald-500 hover:bg-emerald-400 text-[11px] font-semibold text-slate-950">
                                ì‹ ê·œ ë“±ë¡
                            </button>
                        </div>
                        <div id="channel-list" class="flex-1 overflow-y-auto text-xs space-y-1">
                            <div class="text-slate-500 text-center py-6 text-xs">
                                ì±„ë„ ëª©ë¡ ë¡œë”© ì¤‘...
                            </div>
                        </div>
                    </div>

                    <!-- ì±„ë„ ìƒì„¸ -->
                    <div class="col-span-3 bg-slate-900/80 border border-slate-800 rounded-2xl p-4 flex flex-col">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <div id="channel-detail-title" class="text-sm font-semibold text-slate-100">
                                    ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”
                                </div>
                                <div id="channel-detail-sub" class="text-xs text-slate-400">
                                    ì™¼ìª½ ëª©ë¡ì—ì„œ ì±„ë„ì„ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                                </div>
                            </div>
                            <button id="btn-refresh-channel"
                                    class="px-2.5 py-1 rounded-lg bg-slate-800 text-[11px] text-slate-200 border border-slate-700 disabled:opacity-40"
                                    disabled>
                                Refresh
                            </button>
                        </div>

                        <div id="channel-detail-body" class="text-xs text-slate-300 space-y-2">
                            <!-- ì„ íƒ ì „ ì•ˆë‚´ -->
                        </div>
                    </div>
                </div>
            </div>

        </section>
    </main>
</div>

<!-- ì‹ ê·œ ì±„ë„ ë“±ë¡ ëª¨ë‹¬ -->
<div id="modal-backdrop" class="fixed inset-0 bg-black/60 items-center justify-center hidden">
    <div class="bg-slate-900 border border-slate-700 rounded-2xl p-5 w-full max-w-md">
        <div class="flex items-center justify-between mb-3">
            <div class="text-sm font-semibold text-slate-100">ì‹ ê·œ ì±„ë„ ë“±ë¡</div>
            <button id="btn-close-modal" class="text-slate-400 text-xs hover:text-slate-200">ë‹«ê¸°</button>
        </div>
        <div class="space-y-3 text-xs">
            <div>
                <label class="block mb-1 text-slate-300">Manifest URL</label>
                <input id="input-new-url" type="text"
                       class="w-full px-3 py-2 rounded-lg bg-slate-950 border border-slate-800 text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-emerald-500"
                       placeholder="https://example.com/master.m3u8">
            </div>
            <div>
                <label class="block mb-1 text-slate-300">User-Agent</label>
                <input id="input-new-ua" type="text" value="console-ui"
                       class="w-full px-3 py-2 rounded-lg bg-slate-950 border border-slate-800 text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-emerald-500">
            </div>
            <div id="new-channel-status" class="text-[11px] text-slate-400"></div>
            <div class="flex justify-end gap-2 mt-2">
                <button id="btn-submit-new"
                        class="px-3 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-400 text-xs font-semibold text-slate-950">
                    ë“±ë¡
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // === API endpoint ì„¤ì • ===
    const API_BASE = ''; // ë™ì¼ ë„ë©”ì¸ì´ë©´ '' ìœ ì§€
    const ENDPOINT_SUMMARY = API_BASE + '/api/dashboard/summary';
    const ENDPOINT_ALARMS = API_BASE + '/api/dashboard/alarms?limit=10';
    const ENDPOINT_HISTORY = API_BASE + '/api/dashboard/history?limit=20';
    const ENDPOINT_CHANNEL_LIST = API_BASE + '/api/channels';
    const ENDPOINT_CHANNEL_DETAIL = traceId => API_BASE + '/api/channels/' + encodeURIComponent(traceId);
    const ENDPOINT_CHANNEL_CREATE = API_BASE + '/probe';
    const ENDPOINT_CHANNEL_REFRESH = traceId => API_BASE + '/probe/' + encodeURIComponent(traceId) + '/refresh';

    const lastRefreshEl = document.getElementById('last-refresh');

    function formatTime(ts) {
        if (!ts) return '-';
        const d = new Date(ts);
        if (Number.isNaN(d.getTime())) return ts;
        return d.toLocaleString();
    }

    async function fetchJson(url, options) {
        const res = await fetch(url, options);
        if (!res.ok) {
            throw new Error('HTTP ' + res.status + ' ' + res.statusText);
        }
        if (res.status === 204) return null;
        const ct = res.headers.get('content-type') || '';
        if (!ct.includes('application/json')) {
            return await res.text();
        }
        return await res.json();
    }

    // === ëŒ€ì‹œë³´ë“œ ë Œë”ë§ ===
    const summaryTotalEl = document.getElementById('summary-total');
    const summaryMonitoringEl = document.getElementById('summary-monitoring');
    const summaryErrorsEl = document.getElementById('summary-errors');
    const alarmListEl = document.getElementById('alarm-list');
    const historyBodyEl = document.getElementById('history-body');

    function renderSummary(data) {
        if (!data) return;
        summaryTotalEl.textContent = data.totalChannels ?? '-';
        summaryMonitoringEl.textContent = data.monitoringChannels ?? '-';
        summaryErrorsEl.textContent = data.errorLast24h ?? '-';
    }

    function renderAlarms(alarms) {
        if (!alarms || alarms.length === 0) {
            alarmListEl.innerHTML = '<div class="text-slate-500 text-center py-6 text-xs">ìµœê·¼ ì•ŒëŒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }
        alarmListEl.innerHTML = alarms.map(a => {
            const badge =
                a.severity === 'ERROR'
                    ? 'bg-red-500/10 text-red-300 border border-red-500/40'
                    : 'bg-amber-500/10 text-amber-300 border border-amber-500/40';

            return `
            <div class="border border-slate-800 rounded-xl px-3 py-2 bg-slate-950/60 flex flex-col gap-1">
                <div class="flex items-center justify-between">
                    <span class="text-[11px] px-2 py-0.5 rounded-full ${badge}">
                        ${a.severity || 'ERROR'}
                    </span>
                    <span class="text-[10px] text-slate-500">${formatTime(a.createdAt)}</span>
                </div>
                <div class="text-[11px] text-slate-200 line-clamp-2">
                    ${a.summaryMessage || a.validationResult || ''}
                </div>
                <div class="flex flex-wrap gap-1 mt-1 text-[10px] text-slate-400">
                    ${a.traceId ? `<span class="px-1.5 py-0.5 rounded bg-slate-900 border border-slate-800">trace=${a.traceId}</span>` : ''}
                    ${a.resolution ? `<span class="px-1.5 py-0.5 rounded bg-slate-900 border border-slate-800">res=${a.resolution}</span>` : ''}
                    ${a.ruleCode ? `<span class="px-1.5 py-0.5 rounded bg-slate-900 border border-slate-800">rule=${a.ruleCode}</span>` : ''}
                </div>
            </div>`;
        }).join('');
    }

    function renderHistory(rows) {
        if (!rows || rows.length === 0) {
            historyBodyEl.innerHTML = `
            <tr>
                <td colspan="5" class="px-2 py-4 text-center text-slate-500 text-xs">ìµœê·¼ ê²€ì¦ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
            </tr>`;
            return;
        }
        historyBodyEl.innerHTML = rows.map(r => {
            let color = 'text-slate-300';
            if (r.status === 'OK') color = 'text-emerald-300';
            else if (r.status === 'WARN') color = 'text-amber-300';
            else if (r.status === 'ERROR') color = 'text-red-300';

            return `
            <tr class="bg-slate-950/70 hover:bg-slate-900">
                <td class="px-2 py-1 align-top text-[11px] text-slate-200">${r.traceId || '-'}</td>
                <td class="px-2 py-1 align-top text-[11px] text-slate-300">${r.resolution || '-'}</td>
                <td class="px-2 py-1 align-top text-[11px] ${color}">${r.status || '-'}</td>
                <td class="px-2 py-1 align-top text-[11px] text-slate-400">${r.ruleCode || '-'}</td>
                <td class="px-2 py-1 align-top text-[11px] text-slate-500">${formatTime(r.createdAt)}</td>
            </tr>`;
        }).join('');
    }

    async function refreshDashboard() {
        try {
            const [summary, alarms, history] = await Promise.all([
                fetchJson(ENDPOINT_SUMMARY),
                fetchJson(ENDPOINT_ALARMS),
                fetchJson(ENDPOINT_HISTORY)
            ]);
            renderSummary(summary);
            renderAlarms(alarms || []);
            renderHistory(history || []);
            lastRefreshEl.textContent = new Date().toLocaleTimeString();
        } catch (e) {
            console.error(e);
            alarmListEl.innerHTML =
                '<div class="text-red-400 text-center py-6 text-xs">ì•ŒëŒ ë¡œë“œ ì‹¤íŒ¨: ' + e.message + '</div>';
        }
    }

    // === ì±„ë„ í™”ë©´ ===
    const channelListEl = document.getElementById('channel-list');
    const channelDetailTitleEl = document.getElementById('channel-detail-title');
    const channelDetailSubEl = document.getElementById('channel-detail-sub');
    const channelDetailBodyEl = document.getElementById('channel-detail-body');
    const btnRefreshChannel = document.getElementById('btn-refresh-channel');
    let currentChannelTraceId = null;

    function renderChannelList(channels) {
        if (!channels || channels.length === 0) {
            channelListEl.innerHTML = '<div class="text-slate-500 text-center py-6 text-xs">ë“±ë¡ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }
        channelListEl.innerHTML = channels.map(c => {
            const statusColor =
                c.status === 'MONITORING' ? 'text-emerald-300' :
                    c.status === 'RETRYING' ? 'text-amber-300' :
                        'text-slate-300';

            return `
            <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-slate-800 flex flex-col gap-1"
                    data-trace-id="${c.traceId}">
                <div class="flex items-center justify-between">
                    <span class="text-[11px] font-semibold text-slate-100 truncate">${c.traceId}</span>
                    <span class="text-[10px] ${statusColor}">${c.status || '-'}</span>
                </div>
                <div class="text-[10px] text-slate-400 truncate">${c.manifestUrl || ''}</div>
                <div class="text-[10px] text-slate-500">
                    ${c.resolution || '-'} â€¢ ë§ˆì§€ë§‰ ì²´í¬: ${formatTime(c.lastCheckedAt)}
                </div>
            </button>`;
        }).join('');

        channelListEl.querySelectorAll('button[data-trace-id]').forEach(btn => {
            btn.addEventListener('click', () => {
                const traceId = btn.getAttribute('data-trace-id');
                if (traceId) {
                    loadChannelDetail(traceId);
                }
            });
        });
    }

    function renderChannelDetail(detail) {
        if (!detail) {
            channelDetailTitleEl.textContent = 'ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”';
            channelDetailSubEl.textContent = 'ì™¼ìª½ ëª©ë¡ì—ì„œ ì±„ë„ì„ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
            channelDetailBodyEl.innerHTML = '';
            btnRefreshChannel.disabled = true;
            currentChannelTraceId = null;
            return;
        }
        currentChannelTraceId = detail.traceId;
        btnRefreshChannel.disabled = false;

        channelDetailTitleEl.textContent = detail.traceId || '(traceId ì—†ìŒ)';
        channelDetailSubEl.textContent = detail.manifestUrl || '';

        const statusColor =
            detail.status === 'MONITORING' ? 'text-emerald-300' :
                detail.status === 'RETRYING' ? 'text-amber-300' :
                    'text-slate-300';

        channelDetailBodyEl.innerHTML = `
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Status</div>
                    <div class="text-[12px] ${statusColor}">${detail.status || '-'}</div>
                </div>
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Resolution</div>
                    <div class="text-[12px] text-slate-300">${detail.resolution || '-'}</div>
                </div>
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Last Checked</div>
                    <div class="text-[12px] text-slate-300">${formatTime(detail.lastCheckedAt)}</div>
                </div>
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Created At</div>
                    <div class="text-[12px] text-slate-300">${formatTime(detail.createdAt)}</div>
                </div>
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Last Validation Result</div>
                    <div class="text-[12px] text-slate-300">${detail.lastValidationResult || '-'}</div>
                </div>
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Last Rule Code</div>
                    <div class="text-[12px] text-slate-300">${detail.lastRuleCode || '-'}</div>
                </div>
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Errors (24h)</div>
                    <div class="text-[12px] text-red-300">${detail.errorCount24h ?? '-'}</div>
                </div>
                <div>
                    <div class="text-[11px] text-slate-500 mb-1">Current Seq</div>
                    <div class="text-[12px] text-slate-300">${detail.seq ?? '-'}</div>
                </div>
            </div>`;
    }

    async function refreshChannelList() {
        try {
            const channels = await fetchJson(ENDPOINT_CHANNEL_LIST);
            renderChannelList(channels || []);
        } catch (e) {
            console.error(e);
            channelListEl.innerHTML =
                '<div class="text-red-400 text-center py-6 text-xs">ì±„ë„ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + e.message + '</div>';
        }
    }

    async function loadChannelDetail(traceId) {
        try {
            const detail = await fetchJson(ENDPOINT_CHANNEL_DETAIL(traceId));
            renderChannelDetail(detail);
        } catch (e) {
            console.error(e);
            channelDetailBodyEl.innerHTML =
                '<div class="text-red-400 text-xs">ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ' + e.message + '</div>';
        }
    }

    // === ì‹ ê·œ ì±„ë„ ëª¨ë‹¬ ===
    const modalBackdrop = document.getElementById('modal-backdrop');
    const btnOpenNewChannel = document.getElementById('btn-open-new-channel');
    const btnCloseModal = document.getElementById('btn-close-modal');
    const btnSubmitNew = document.getElementById('btn-submit-new');
    const inputNewUrl = document.getElementById('input-new-url');
    const inputNewUa = document.getElementById('input-new-ua');
    const newChannelStatus = document.getElementById('new-channel-status');

    function openModal() {
        modalBackdrop.classList.remove('hidden');
        modalBackdrop.classList.add('flex');
        newChannelStatus.textContent = '';
        inputNewUrl.value = '';
        inputNewUrl.focus();
    }

    function closeModal() {
        modalBackdrop.classList.add('hidden');
        modalBackdrop.classList.remove('flex');
    }

    btnOpenNewChannel.addEventListener('click', openModal);
    btnCloseModal.addEventListener('click', closeModal);

    btnSubmitNew.addEventListener('click', async () => {
        const url = inputNewUrl.value.trim();
        const ua = inputNewUa.value.trim() || 'console-ui';

        if (!url) {
            newChannelStatus.textContent = 'Manifest URLì„ ì…ë ¥í•˜ì„¸ìš”.';
            newChannelStatus.className = 'text-[11px] text-red-400';
            return;
        }

        newChannelStatus.textContent = 'ë“±ë¡ ì¤‘...';
        newChannelStatus.className = 'text-[11px] text-slate-400';

        try {
            const res = await fetch(ENDPOINT_CHANNEL_CREATE, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({url, userAgent: ua})
            });

            if (!res.ok) {
                const text = await res.text();
                newChannelStatus.textContent = 'ì„œë²„ ì˜¤ë¥˜: ' + text;
                newChannelStatus.className = 'text-[11px] text-red-400';
                return;
            }

            const data = await res.json();
            newChannelStatus.textContent = 'ë“±ë¡ ì™„ë£Œ. traceId=' + (data.traceId || '(ì‘ë‹µ ì—†ìŒ)');
            newChannelStatus.className = 'text-[11px] text-emerald-300';

            await refreshChannelList();
        } catch (e) {
            newChannelStatus.textContent = 'ìš”ì²­ ì‹¤íŒ¨: ' + e.message;
            newChannelStatus.className = 'text-[11px] text-red-400';
        }
    });

    // ì±„ë„ refresh ë²„íŠ¼
    btnRefreshChannel.addEventListener('click', async () => {
        if (!currentChannelTraceId) return;
        btnRefreshChannel.disabled = true;
        try {
            await fetch(ENDPOINT_CHANNEL_REFRESH(currentChannelTraceId), {
                method: 'POST'
            });
            // refresh í›„ ìƒì„¸/ëŒ€ì‹œë³´ë“œ ë‘˜ ë‹¤ ë‹¤ì‹œ ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€ëŠ” ììœ 
            await loadChannelDetail(currentChannelTraceId);
            await refreshDashboard();
        } catch (e) {
            console.error(e);
        } finally {
            btnRefreshChannel.disabled = false;
        }
    });

    // === ë„¤ë¹„ê²Œì´ì…˜ (ëŒ€ì‹œë³´ë“œ / ì±„ë„ ì „í™˜) ===
    const navDashboard = document.getElementById('nav-dashboard');
    const navChannels = document.getElementById('nav-channels');
    const viewDashboard = document.getElementById('view-dashboard');
    const viewChannels = document.getElementById('view-channels');
    const headerTitle = document.getElementById('header-title');
    const headerSubtitle = document.getElementById('header-subtitle');

    function showDashboard() {
        viewDashboard.classList.remove('hidden');
        viewChannels.classList.add('hidden');
        navDashboard.classList.add('bg-slate-800', 'text-slate-100');
        navChannels.classList.remove('bg-slate-800', 'text-slate-100');
        navChannels.classList.add('text-slate-300');
        headerTitle.textContent = 'Validation Dashboard';
        headerSubtitle.textContent = 'ì‹¤ì‹œê°„ HLS manifest ìœ íš¨ì„± ìƒíƒœ';
    }

    function showChannels() {
        viewChannels.classList.remove('hidden');
        viewDashboard.classList.add('hidden');
        navChannels.classList.add('bg-slate-800', 'text-slate-100');
        navDashboard.classList.remove('bg-slate-800', 'text-slate-100');
        navDashboard.classList.add('text-slate-300');
        headerTitle.textContent = 'ì±„ë„ ê´€ë¦¬';
        headerSubtitle.textContent = 'ëª¨ë‹ˆí„°ë§ ì¤‘ì¸ ì±„ë„ ì¡°íšŒ ë° ì œì–´';
    }

    navDashboard.addEventListener('click', () => {
        showDashboard();
        refreshDashboard();
    });

    navChannels.addEventListener('click', () => {
        showChannels();
        refreshChannelList();
    });

    document.getElementById('refresh-btn').addEventListener('click', () => {
        if (!viewDashboard.classList.contains('hidden')) {
            refreshDashboard();
        } else {
            refreshChannelList();
            if (currentChannelTraceId) {
                loadChannelDetail(currentChannelTraceId);
            }
        }
    });

    // ì´ˆê¸° ë¡œë”©
    showDashboard();
    refreshDashboard();
</script>
</body>
</html>
