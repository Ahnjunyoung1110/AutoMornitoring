# 공통(모든 프로필 공통)
spring:
  application:
    name: AutoMornitoring
  jpa:
    open-in-view: false
    properties:
      hibernate:
        format_sql: true

logging:
  level:
    org.hibernate.SQL: debug
    org.hibernate.orm.jdbc.bind: trace

# --- 개발/테스트: H2 + 로컬 RabbitMQ(또는 Docker Desktop의 localhost) ---
---
spring:
  config:
    activate:
      on-profile: dev
  datasource:
    url: jdbc:h2:mem:app;MODE=MySQL;DATABASE_TO_UPPER=false;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password:
  jpa:
    hibernate:
      ddl-auto: create-drop

  rabbitmq:
    host: localhost        # 로컬에서 스프링만 실행할 때
    port: 5672
    username: guest        # 로컬 기본 계정
    password: guest
    listener:
      simple:
        acknowledge-mode: AUTO   # 필요시 MANUAL로 변경
        prefetch: 20             # 메시지 당겨오는 개수(옵션)
    template:
      reply-timeout: 3000ms
      mandatory: false
    publisher-confirm-type: correlated  # 퍼블리셔 확인(옵션)

# --- 운영/도커: MySQL + Compose RabbitMQ 서비스(host: rabbitmq) ---
---
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    url: jdbc:mysql://mysql:3306/mydatabase?useSSL=false&allowPublicKeyRetrieval=true&characterEncoding=utf8
    username: myuser
    password: secret
  jpa:
    hibernate:
      ddl-auto: update      # 운영 정책에 맞게 validate 권장

  rabbitmq:
    host: rabbitmq          # docker-compose 서비스명
    port: 5672
    username: myuser        # compose에서 만든 계정과 일치
    password: secret
    listener:
      simple:
        acknowledge-mode: AUTO
        prefetch: 50
    template:
      reply-timeout: 3000ms
      mandatory: false
    publisher-confirm-type: correlated
